(function () {
	var lang = document.getElementsByTagName("html")[0].getAttribute("lang");
	if (lang !== 'en')
		tinymce.PluginManager.requireLangPack('xhplugincall', lang);
	tinymce.PluginManager.add('xhplugincall', function (editor, url) {
		editor.settings.content_css += ', ' + url + '/style.css';
		editor.addButton('xhplugincall', {
			text: false,
			icon: false,
			image: url + '/xhplugincall.svg',
			tooltip: 'Insert a XH plugin call',
			onclick: function () {
        var initial = editor.selection.getContent().match(/\{{3}(.*)\}{3}/);
				editor.windowManager.open({
					title: 'Insert a XH plugin call',
					body: [{
							type: 'textbox',
							name: 'title',
							label: 'Paste here the XH plugin call - without {{{}}}',
              value: initial? initial[1] : ""
						}
					],
					onsubmit: function (e) {
						editor.insertContent('<div class="xhplugincall mceNonEditable">{{{' + e.data.title + '}}}</div>');
					}
				});
			}
		});
	});
})();
